<!DOCTYPE html><html data-astro-cid-dxa6k4ug lang=es><head><meta charset=utf-8><title>Validación de QR</title><meta content="width=device-width,initial-scale=1" name=viewport><meta content=noindex,nofollow name=robots><link href=/inbolsaNeo/_astro/index.CDTwtXTb.css rel=stylesheet><style>:root{color-scheme:light dark;font-synthesis-weight:none}body{font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,"Apple Color Emoji","Segoe UI Emoji";margin:0;background:#0b0b11;color:#e6e6e6}.wrap[data-astro-cid-dxa6k4ug]{max-width:920px;margin:48px auto;padding:0 16px}.card[data-astro-cid-dxa6k4ug]{background:#11131a;border:1px solid #222536;border-radius:16px;padding:20px}.ok[data-astro-cid-dxa6k4ug]{color:#7ee787}.bad[data-astro-cid-dxa6k4ug]{color:#ff7b72}.muted[data-astro-cid-dxa6k4ug]{color:#9aa3b2}.btn[data-astro-cid-dxa6k4ug]{display:inline-block;padding:10px 14px;border-radius:10px;border:1px solid #2c3244;color:#cbd5e1;text-decoration:none}.btn[data-astro-cid-dxa6k4ug]:hover{background:#1b2030}code[data-astro-cid-dxa6k4ug].kbd{background:#0d1019;border:1px solid #293148;padding:4px 6px;border-radius:8px}</style></head><body data-astro-cid-dxa6k4ug><main class=wrap data-astro-cid-dxa6k4ug><h1 data-astro-cid-dxa6k4ug style="font-size:28px;margin:0 0 16px 0">Validación de QR</h1><div data-astro-cid-dxa6k4ug id=box class=card><div data-astro-cid-dxa6k4ug id=msg class=muted>Comprobando…</div><div data-astro-cid-dxa6k4ug id=extra style=margin-top:10px></div><div data-astro-cid-dxa6k4ug style=margin-top:16px><a class=btn data-astro-cid-dxa6k4ug href=/ >Volver al inicio</a></div></div></main><script type=module>(async()=>{const e="inbolsa_access_token",o=document.getElementById("msg"),a=document.getElementById("extra"),t=new URLSearchParams(location.search).get("code")||"";function c(e,a=""){o&&(o.className=a||"muted",o.innerHTML=e)}if(!t)return c('Falta el parámetro <code class="kbd">code</code>.',"bad"),void(a.innerHTML="");try{const o=await fetch("/api/qr/validate?code="+encodeURIComponent(t),{credentials:"include"}),n=await o.json();if(o.ok&&n&&n.valid){try{localStorage.setItem(e,n.accessToken)}catch{}try{const e=new URL(location.href);e.searchParams.delete("code"),history.replaceState({},"",e)}catch{}const o="number"==typeof n.ttl?n.ttl:null;c('✅ <span class="ok">QR válido</span>. Acceso concedido.'+(o?` <span class="muted">(TTL: ${o}s)</span>`:""),"ok"),a.innerHTML=`<div style="margin-top:6px">code: <code class="kbd">${t}</code></div>\n                               <div style="margin-top:10px"><a class="btn" href="/productos">Ir a productos desbloqueados</a></div>`,setTimeout((()=>{location.replace("/productos")}),500)}else{c('❌ <span class="bad">QR inválido o expirado</span>. '+(n?.error||"No autorizado"),"bad"),a.innerHTML='<div class="muted">Solicite un nuevo QR.</div>';try{localStorage.removeItem(e)}catch{}}}catch(e){console.error(e),c("No se pudo validar el QR. Inténtalo nuevamente.","bad"),a.innerHTML=""}})()</script></body></html>