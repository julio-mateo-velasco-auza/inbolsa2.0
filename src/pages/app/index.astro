---
export const prerender = true;
import Base from '../../layouts/Base.astro';
---

<Base title="Inbolsa · App">
  <section class="min-h-dvh grid place-items-center p-6">
    <div class="w-full max-w-md text-center">
      <h1 class="text-2xl font-semibold">Inbolsa · App</h1>
      <p class="text-slate-600 mt-2">Comprobando sesión…</p>
    </div>
  </section>

  <script type="module">
    const API  = window.__API;
    const BASE = window.__BASE;

    (async () => {
      try {
        const r = await fetch(API + '/auth/me', { credentials: 'include' });
        const d = await r.json().catch(() => ({}));
        if (d?.auth === true) {
          location.replace(BASE + '/app/panel');
        } else {
          location.replace(BASE + '/app/login');
        }
      } catch {
        location.replace(BASE + '/app/login');
      }
    })();
  </script>
</Base>
