---
import AppLayout from '../../layouts/AppLayout.astro';
---
<AppLayout title="Inbolsa · App">
  <section class="relative overflow-hidden py-16">
    <div class="absolute -top-40 -left-40 h-80 w-80 rounded-full bg-brand-300 blur-3xl opacity-40"></div>

    <div class="mx-auto max-w-3xl px-4">
      <div class="rounded-3xl border border-slate-200 bg-white p-10 shadow-sm">
        <div class="flex items-center gap-2 font-semibold text-brand-700">
          <span class="inline-block h-2 w-2 rounded-full bg-brand-600 shadow-[0_0_16px_2px_rgba(62,125,210,.4)]"></span>
          Inbolsa · App
        </div>

        <h1 class="mt-3 text-3xl font-semibold tracking-tight">Área privada</h1>
        <p class="mt-2 text-slate-600">
          Portal de administración para generación y gestión de códigos QR.
        </p>

        <div class="mt-8 grid gap-3 sm:grid-cols-2">
          <a href="/app/login"
             class="inline-flex items-center justify-center rounded-xl bg-brand-600 px-6 py-3 text-white hover:bg-brand-700 transition">
            Iniciar sesión
          </a>

          <a href="/" 
             class="inline-flex items-center justify-center rounded-xl border border-slate-300 px-6 py-3 hover:border-brand-400 hover:text-brand-700 transition">
            Ir al sitio público
          </a>
        </div>

        <div class="mt-6 grid sm:grid-cols-2 gap-3">
          <button id="btnGenerate" disabled
            class="rounded-xl px-6 py-3 border border-slate-200 text-slate-400 cursor-not-allowed">
            Generar QR (requiere login)
          </button>
          <button id="btnPanel" disabled
            class="rounded-xl px-6 py-3 border border-slate-200 text-slate-400 cursor-not-allowed">
            Panel (requiere login)
          </button>
        </div>

        <p class="mt-4 text-xs text-slate-500">
          *Esta es la portada del App (separada del sitio público). Primero inicia sesión para continuar.
        </p>
      </div>
    </div>
  </section>

  <script type="module">
    // Si hay sesión, habilitamos botones y redirigen
    try {
      const r = await fetch('/api/auth/me', { credentials: 'include' });
      const d = await r.json();
      if (d?.authenticated) {
        const gen = document.getElementById('btnGenerate');
        const pan = document.getElementById('btnPanel');
        if (gen) {
          gen.disabled = false;
          gen.classList.remove('text-slate-400','cursor-not-allowed');
          gen.addEventListener('click', () => location.href = '/app/panel#gen');
        }
        if (pan) {
          pan.disabled = false;
          pan.classList.remove('text-slate-400','cursor-not-allowed');
          pan.addEventListener('click', () => location.href = '/app/panel');
        }
      }
    } catch {}
  </script>
</AppLayout>
